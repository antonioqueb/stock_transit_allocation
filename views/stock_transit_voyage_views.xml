<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 1. VISTA DE LISTA -->
    <record id="view_stock_transit_voyage_list" model="ir.ui.view">
        <field name="name">stock.transit.voyage.list</field>
        <field name="model">stock.transit.voyage</field>
        <field name="arch" type="xml">
            <list decoration-info="state == 'in_transit'" decoration-success="state == 'arrived'">
                <field name="name"/>
                <field name="container_number" string="Contenedores"/>
                <field name="bl_number" string="Folio Compra / BL"/>
                <field name="eta" widget="remaining_days"/>
                <field name="total_m2" sum="Total"/>
                <field name="allocation_percent" widget="progressbar" string="% Asig."/>
                <field name="state" widget="badge" decoration-info="state == 'in_transit'" decoration-warning="state == 'at_port'"/>
            </list>
        </field>
    </record>

    <!-- 2. VISTA DE FORMULARIO -->
    <record id="view_stock_transit_voyage_form" model="ir.ui.view">
        <field name="name">stock.transit.voyage.form</field>
        <field name="model">stock.transit.voyage</field>
        <field name="arch" type="xml">
            <form string="Gesti칩n de Tr치nsito">
                <header>
                    <button name="action_load_from_picking" string="游댃 Recargar Datos" type="object" class="btn-secondary" invisible="state == 'arrived'"/>
                    <button name="action_confirm_transit" string="游뚹 Confirmar Zarpe" type="object" class="btn-primary" invisible="state != 'draft'"/>
                    <button name="action_arrive" string="游끠 Registrar Llegada" type="object" class="btn-success" invisible="state != 'in_transit'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,in_transit,at_port,arrived"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name"/></h1>
                        <h3><field name="container_number" placeholder="Contenedor(es)"/></h3>
                    </div>
                    <group>
                        <group string="Detalles de Log칤stica">
                            <field name="vessel_name"/>
                            <field name="bl_number" string="Folio Compra / BL"/>
                            <field name="picking_id" readonly="1"/>
                        </group>
                        <group string="Itinerario">
                            <field name="etd"/>
                            <field name="eta"/>
                            <field name="arrival_date" readonly="1"/>
                            <field name="transit_progress" widget="transit_ship_progress"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Contenido y Asignaci칩n" name="lots">
                            <field name="line_ids">
                                <list create="0" delete="0" decoration-success="allocation_status == 'reserved'">
                                    <field name="container_number" optional="show"/> 
                                    <field name="product_id"/>
                                    <field name="lot_id"/>
                                    <field name="product_uom_qty" string="m"/>
                                    
                                    <!-- Nuevas Columnas Solicitadas -->
                                    <field name="partner_id" widget="many2one_avatar"/>
                                    <field name="order_id" optional="show" widget="badge" decoration-info="order_id"/>
                                    
                                    <field name="allocation_status" widget="badge" decoration-success="allocation_status == 'reserved'" decoration-info="allocation_status == 'available'"/>
                                    <button name="action_reassign_wizard" string="游댃 Reasignar" type="object" class="btn-link"/>
                                </list>
                            </field>
                        </page>
                        <page string="Estad칤sticas">
                            <group>
                                <field name="total_m2"/>
                                <field name="allocated_m2"/>
                                <field name="allocation_percent" widget="progressbar"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- 3. VISTA KANBAN -->
    <record id="view_stock_transit_voyage_kanban" model="ir.ui.view">
        <field name="name">stock.transit.voyage.kanban</field>
        <field name="model">stock.transit.voyage</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column" records_draggable="0" sample="1">
                <field name="state"/>
                <field name="name"/>
                <field name="vessel_name"/>
                <field name="container_number"/>
                <field name="eta"/>
                <field name="allocation_percent"/>
                <!-- Se requiere transit_progress en kanban para que calcule bien -->
                <field name="transit_progress"/> 
                <templates>
                    <t t-name="card">
                        <div class="d-flex flex-column">
                            <div class="d-flex justify-content-between mb-2">
                                <strong class="o_kanban_record_title text-primary">
                                    <field name="name"/>
                                </strong>
                                <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'in_transit': 'info', 'at_port': 'warning', 'arrived': 'success'}}"/>
                            </div>
                            
                            <div class="text-muted mb-1" invisible="not vessel_name">
                                <i class="fa fa-ship me-1" title="Barco"/>
                                <field name="vessel_name"/>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                <span class="text-muted small">
                                    ETA: <field name="eta" widget="remaining_days"/>
                                </span>
                            </div>
                            
                            <!-- Barra de Asignaci칩n (Ventas) -->
                            <div class="mt-2" title="Porcentaje Asignado a Cliente">
                                <small>Asignado:</small>
                                <field name="allocation_percent" widget="progressbar"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- ========================================================== -->
    <!-- 4. ACCIONES Y MEN칔S (NUEVO)                               -->
    <!-- ========================================================== -->

    <!-- Acci칩n de Ventana Principal -->
    <record id="action_stock_transit_voyage_main" model="ir.actions.act_window">
        <field name="name">Torre de Control</field>
        <field name="res_model">stock.transit.voyage</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cree el primer registro de Tr치nsito Mar칤timo
            </p>
            <p>
                Gestione contenedores, fechas de arribo (ETA) y asignaci칩n de mercanc칤a en tr치nsito.
            </p>
        </field>
    </record>

    <!-- Men칰 Ra칤z (Aparecer치 en el dashboard principal de Odoo) -->
    <!-- Nota: web_icon asume que tienes una imagen en /static/description/icon.png -->
    <menuitem id="menu_transit_root"
              name="Torre de Control"
              web_icon="stock_transit_allocation,static/description/icon.png"
              sequence="10"
              groups="stock_transit_allocation.group_transit_user"/>

    <!-- Submen칰 Principal -->
    <menuitem id="menu_transit_voyage_dashboard"
              name="Tablero de Viajes"
              parent="menu_transit_root"
              action="action_stock_transit_voyage_main"
              sequence="1"/>

</odoo>